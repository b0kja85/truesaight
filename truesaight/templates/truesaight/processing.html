{% extends 'base.html' %}

{% block content %}
<div class="text-center mt-5">
    <h2>Processing Video...</h2>
    <p>Status: <span id="status">{{ video.status }}</span></p>
    <div class="spinner-border text-primary mt-3" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<script>
    function checkStatus() {
      var videoId = "{{ video.id }}";
      fetch(`/video-status/${videoId}/`)
        .then(response => response.json())
        .then(data => {
          const statusElement = document.getElementById('status');
          statusElement.innerText = data.status;

          if (data.status === 'completed') {
            window.location.href = "{% url 'truesaight:result' pk=video.id %}";
          } else if (data.status === 'failed') {
            alert("Processing failed. Please try again.");
          } else {
            // Status is still "processing", reload page
            window.location.reload();
          }
        })
        .catch(error => {
          console.error('Error fetching status:', error);
        });
    }

    // Poll every 10 secoonds
    setInterval(checkStatus, 10000);
</script>
{% endblock %}
